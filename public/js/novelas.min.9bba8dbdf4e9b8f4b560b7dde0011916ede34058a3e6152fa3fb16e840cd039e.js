(function(){"use strict";const t={allNovels:[],filteredNovels:[],currentPage:1,itemsPerPage:10,selectedGenres:new Set,searchQuery:""},e={};let s;async function o(){e.searchInput=document.getElementById("searchInput"),e.filterToggle=document.getElementById("filterToggle"),e.genreFilters=document.getElementById("genreFilters"),e.genreList=document.getElementById("genreList"),e.novelsGrid=document.getElementById("novelsGrid"),e.noResultsMessage=document.getElementById("noResultsMessage"),e.paginationBottom=document.getElementById("paginationBottom"),e.itemsPerPageSelect=document.getElementById("itemsPerPage"),e.prevPageBottom=document.getElementById("prevPageBottom"),e.nextPageBottom=document.getElementById("nextPageBottom"),e.pageInfoBottom=document.getElementById("pageInfoBottom");try{const e=await fetch("/novelas/novelas.json");if(!e.ok)throw new Error("Error al cargar novelas");t.allNovels=await e.json(),t.filteredNovels=t.allNovels.slice(),l(),d(),n(),c()}catch(e){console.error(e)}}function l(){e.searchInput.addEventListener("input",e=>{const n=e.target.value.trim().toLowerCase();clearTimeout(s),s=setTimeout(()=>{t.searchQuery=n,i()},300)}),e.filterToggle.addEventListener("click",()=>{const t=e.filterToggle.getAttribute("aria-expanded")==="true";e.filterToggle.setAttribute("aria-expanded",!t),e.genreFilters.classList.toggle("is-open")}),e.itemsPerPageSelect.addEventListener("change",e=>{const s=e.target.value;t.itemsPerPage=s==="all"?t.filteredNovels.length:+s,t.currentPage=1,n(),r()}),e.prevPageBottom.addEventListener("click",()=>a(-1)),e.nextPageBottom.addEventListener("click",()=>a(1))}function d(){const n=new Set;for(const e of t.allNovels)for(const t of e.genres)n.add(t);const s=[...n].sort();e.genreList.innerHTML=s.map(e=>`<button class="genreTag" data-genre="${e}" role="checkbox" aria-checked="false">${e}</button>`).join(""),e.genreList.addEventListener("click",e=>{const n=e.target.closest(".genreTag");if(!n)return;const s=n.dataset.genre,o=t.selectedGenres.has(s);o?(t.selectedGenres.delete(s),n.classList.remove("active"),n.setAttribute("aria-checked","false")):(t.selectedGenres.add(s),n.classList.add("active"),n.setAttribute("aria-checked","true")),i()})}function i(){const e=t.searchQuery,s=t.selectedGenres,o=s.size>0;t.filteredNovels=t.allNovels.filter(t=>{if(e){const n=t.nameJp.toLowerCase().includes(e)||t.nameEn.toLowerCase().includes(e)||t.nameEs&&t.nameEs.toLowerCase().includes(e)||t.novelTitle&&t.novelTitle.toLowerCase().includes(e);if(!n)return!1}if(o)for(const e of s)if(!t.genres.includes(e))return!1;return!0}),t.currentPage=1,n(),c()}function n(){const n=(t.currentPage-1)*t.itemsPerPage,s=t.filteredNovels.slice(n,n+t.itemsPerPage);if(s.length===0)e.novelsGrid.style.display="none",e.noResultsMessage.style.display="block";else{e.novelsGrid.style.display="grid",e.noResultsMessage.style.display="none";const t=document.createDocumentFragment(),n=document.createElement("template");for(const e of s)n.innerHTML=`
          <a href="/novelas/${e.link}" class="novelCard" style="view-transition-name: n${e.id}">
            <div class="novelCoverContainer">
              <picture>
                <source srcset="/img/cover/avif/${e.id}.avif" type="image/avif" />
                <img src="/img/cover/jpg/${e.id}.jpg" alt="${e.nameJp}" class="novelCover" loading="lazy" />
              </picture>
              <div class="hoverOverlay">
                <span>Leer Ahora</span>
              </div>
            </div>
          </a>`,t.appendChild(n.content.firstElementChild.cloneNode(!0));e.novelsGrid.innerHTML="",e.novelsGrid.appendChild(t)}r()}function a(e){t.currentPage+=e,n(),window.scrollTo({top:0,behavior:"smooth"})}function r(){const n=Math.ceil(t.filteredNovels.length/t.itemsPerPage)||1;e.pageInfoBottom.textContent=`PÃ¡gina ${t.currentPage} de ${n}`,e.prevPageBottom.disabled=t.currentPage===1,e.nextPageBottom.disabled=t.currentPage>=n}function c(){e.paginationBottom.style.display=t.filteredNovels.length>10?"flex":"none"}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o):o()})()